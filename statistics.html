<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>إحصائيات شجرة أسرة السياط</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;700&display=swap');

        body {
            font-family: 'Noto Naskh Arabic', sans-serif;
            direction: rtl; /* Set the text direction to right-to-left */
        }
        .container {
            width: 30%;
            margin: 0 auto;
        }
        
        @media only screen and (max-width: 600px) {
            .container {
                width: 90%; /* Adjust the width for mobile devices */
            }
        }

        h2 {
            text-align: center;
            direction: ltr; /* Set the text direction to left-to-right */
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        .top-names li {
            background: #f4f4f4;
            margin: 5px 0;
            padding: 10px;
            border: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
        }
        .top-children li {
            background: #f4f4f4;
            margin: 5px 0;
            padding: 10px;
            border: 1px solid #ddd;
            display: flex;
            flex-direction: column; /* To make children elements stack vertically */
        }
        .name {
            flex: 1;
            text-align: right;
        }
        .count {
            flex: 0.5;
            text-align: left;
        }
        .total-members {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px; /* Adjust font size here */
            font-weight: bold; /* Add bold styling */
            color: #333; /* Change text color */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="total-members" id="total-members"></div>
        <h2>أكثر الأسماء تكراراً</h2>
        <ul id="top-names" class="top-names"></ul>

        <h2>ًأكثر الأفراد أبناء</h2>
        <ul id="top-children" class="top-children"></ul>
    </div>

    <script>
        async function fetchStatistics() {
    try {
        // Replace with the actual URL of your `index.html` on GitHub Pages
        const response = await fetch('https://<username>.github.io/<repository>/index.html');
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        const html = await response.text();

        // Extract JSON data from HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        // Assume `familyTreeStatistics` is in a <script> tag with id `family-data`
        const scriptContent = doc.querySelector('#family-data').textContent;
        const statistics = JSON.parse(scriptContent);

        // Call function to display statistics
        displayStatistics(statistics);
    } catch (error) {
        console.error('There has been a problem with your fetch operation:', error);
    }
}

function displayStatistics(statistics) {
    const { topNames, topChildren, totalMembers } = statistics;

            // Display the total number of family members
            document.getElementById('total-members').innerText = `إجمالي عدد أفراد الأسرة: ${totalMembers}`;

            // Group names by their count for the first list
            const groupedNames = {};
            topNames.forEach(([name, count]) => {
                if (!groupedNames[count]) {
                    groupedNames[count] = [];
                }
                groupedNames[count].push(name);
            });

            // Convert grouped names to an array and sort by count
            const sortedNames = Object.entries(groupedNames)
                .map(([count, names]) => [names.join('، '), parseInt(count)])
                .sort((a, b) => b[1] - a[1]);

            // Display all results for the first list
            const topNamesList = document.getElementById('top-names');
            sortedNames.forEach(([names, count]) => {
                const li = document.createElement('li');
                li.innerHTML = `<div class="name">${names}</div><div class="count">${count}</div>`;
                topNamesList.appendChild(li);
            });

            // Group people by number of children for the second list
            const groupedChildren = {};
            topChildren.forEach(({ fullName, children }) => {
                if (!groupedChildren[children]) {
                    groupedChildren[children] = [];
                }
                groupedChildren[children].push(fullName);
            });

            // Convert grouped children to an array and sort by number of children
            const sortedChildren = Object.entries(groupedChildren)
                .map(([children, names]) => [names, parseInt(children)])
                .sort((a, b) => b[1] - a[1]);

            // Display top 10 results for the second list
            const topChildrenList = document.getElementById('top-children');
            let resultCount = 0;
            for (const [names, children] of sortedChildren) {
                if (resultCount >= 10) break; // Ensure only 10 unique results

                const li = document.createElement('li');
                li.innerHTML = `<div class="count">عدد الأبناء: ${children}</div>`;
                names.forEach(name => {
                    const nameDiv = document.createElement('div');
                    nameDiv.className = 'name';
                    nameDiv.innerText = `- ${name}.`; // Add text before and after the name
                    li.appendChild(nameDiv);
                });
                topChildrenList.appendChild(li);
                resultCount++;
            }
        }

        document.addEventListener('DOMContentLoaded', displayStatistics);
    </script>
</body>
</html>
